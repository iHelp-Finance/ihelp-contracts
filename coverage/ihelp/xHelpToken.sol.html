<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for ihelp/xHelpToken.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">ihelp/</a> xHelpToken.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">31.11% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>14/45</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">21.43% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>3/14</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">42.86% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>6/14</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">31.11% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>14/45</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: GPL-3.0
&nbsp;
pragma solidity ^0.8.9;
&nbsp;
import "@openzeppelin/contracts-upgradeable/access/OwnableUpgradeable.sol";
import "@openzeppelin/contracts-upgradeable/token/ERC20/extensions/ERC20CappedUpgradeable.sol";
import "@openzeppelin/contracts/utils/structs/EnumerableSet.sol";
import "./iHelpTokenInterface.sol";
&nbsp;
import "hardhat/console.sol";
&nbsp;
contract xHelpToken is ERC20CappedUpgradeable, OwnableUpgradeable {
    using EnumerableSet for EnumerableSet.AddressSet;
&nbsp;
    iHelpTokenInterface public ihelpToken;
&nbsp;
    uint256 public processingState;
    uint256 public __processingGasLimit;
&nbsp;
    uint256 internal __rewardAwarded;
    EnumerableSet.AddressSet private stakeholders;
&nbsp;
    mapping(address =&gt; uint256) public claimed;
&nbsp;
    function initialize(
        string memory _name,
        string memory _symbol,
        address _token
    ) public initializer {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(address(_token) != address(0), "token is not defined");
&nbsp;
        __ERC20_init(_name, _symbol);
        __ERC20Capped_init_unchained(20000000 * 1000000000000000000);
        __Ownable_init();
&nbsp;
        ihelpToken = iHelpTokenInterface(_token);
        __processingGasLimit = 300_000;
    }
&nbsp;
    function deposit(uint256 _pie) external {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_pie != 0, "Funding/deposit-zero");
&nbsp;
        stakeholders.add(msg.sender);
&nbsp;
        _mint(msg.sender, _pie);
&nbsp;
        <span class="missing-if-branch" title="else path not taken" >E</span>require(ihelpToken.transferFrom(msg.sender, address(this), _pie), "could not transfer tokens");
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function withdraw(uint256 requestedAmount) external {</span>
<span class="cstat-no" title="statement not covered" >        require(requestedAmount != 0, "Funding/withdraw-zero")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        _burn(msg.sender, requestedAmount)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        if (balanceOf(msg.sender) == 0) {</span>
<span class="cstat-no" title="statement not covered" >            stakeholders.remove(msg.sender)</span>;
        }
&nbsp;
<span class="cstat-no" title="statement not covered" >        require(ihelpToken.transfer(msg.sender, requestedAmount), "could not transfer tokens")</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function balance() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return balanceOf(msg.sender);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function claimableReward() public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        return claimableRewardOf(msg.sender);</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function claimableRewardOf(address _addr) public view returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >        uint256 totalStaked = totalSupply();</span>
<span class="cstat-no" title="statement not covered" >        console.log("totalStaked", totalStaked)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 totalReward = totalToReward();</span>
<span class="cstat-no" title="statement not covered" >        console.log("totalReward", totalReward)</span>;
<span class="cstat-no" title="statement not covered" >        console.log("stakeholder", _addr)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 helpStaked = balanceOf(_addr);</span>
<span class="cstat-no" title="statement not covered" >        console.log("helpStaked", helpStaked)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 rewardShare = helpStaked / totalStaked;</span>
<span class="cstat-no" title="statement not covered" >        console.log("rewardShare", rewardShare)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 reward = rewardShare * totalReward;</span>
<span class="cstat-no" title="statement not covered" >        console.log("reward", reward)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint256 claimedAmount = claimed[_addr];</span>
<span class="cstat-no" title="statement not covered" >        console.log("claimed", reward)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        return reward - claimedAmount;</span>
    }
&nbsp;
    function totalAwarded() public view returns (uint256) {
        return totalToReward();
    }
&nbsp;
    function rewardToken() public view returns (IERC20) {
        return ihelpToken.getUnderlyingToken();
    }
&nbsp;
    function stakingPool() public view returns (address) {
        return ihelpToken.getStakingPool();
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function holdingPool() public view returns (address) {</span>
<span class="cstat-no" title="statement not covered" >        return ihelpToken.getHoldingPool();</span>
    }
&nbsp;
    function totalToReward() public view returns (uint256) {
        return rewardToken().balanceOf(stakingPool());
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getStakeholders() public view returns (address[] memory) {</span>
<span class="cstat-no" title="statement not covered" >        return stakeholders.values();</span>
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function claimReward() public {</span>
<span class="cstat-no" title="statement not covered" >        uint256 claimAmount = claimableRewardOf(msg.sender);</span>
<span class="cstat-no" title="statement not covered" >        console.log("claiming reward", msg.sender, claimAmount)</span>;
<span class="cstat-no" title="statement not covered" >        rewardToken().transfer(msg.sender, claimAmount)</span>;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function claimSpecificReward(uint256 amount) public {</span>
<span class="cstat-no" title="statement not covered" >        uint256 claimAmount = claimableRewardOf(msg.sender);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        require(claimAmount &gt;= amount, "not enough claimable balance for amount")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        console.log("claiming reward", msg.sender, amount)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        claimed[msg.sender] += amount</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >        rewardToken().transfer(msg.sender, amount)</span>;
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Tue Jul 12 2022 12:54:35 GMT+0800 (Central Indonesia Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
